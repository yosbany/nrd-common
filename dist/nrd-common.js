!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NRDCommon=t():e.NRDCommon=t()}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AuthService:()=>G,DEFAULT_LOG_LEVEL:()=>l,INIT_TIMEOUT:()=>s,LOG_COLORS:()=>i,LOG_LEVELS:()=>n,Logger:()=>o,MODULE_CHECK_INTERVAL:()=>a,NavigationService:()=>_,REQUIRED_GLOBALS:()=>d,REQUIRED_MODULES:()=>c,createAppHeader:()=>k,createElement:()=>x,createLogger:()=>r,default:()=>J,escapeHtml:()=>I,filterBySearch:()=>H,formatCurrency:()=>O,formatDate:()=>P,formatDecimalWithComma:()=>M,formatNumber:()=>T,getMonthName:()=>$,hideSpinner:()=>N,initializeAppHeader:()=>B,initializeApplication:()=>p,initializeNRD:()=>f,isDateInRange:()=>V,matchesSearch:()=>z,normalizeSearchText:()=>F,parseDecimalWithComma:()=>U,querySelectorSafe:()=>A,setupInstallButton:()=>R,showAlert:()=>y,showConfirm:()=>v,showError:()=>S,showErrorAlert:()=>E,showInfo:()=>L,showInitError:()=>g,showSpinner:()=>D,showSuccess:()=>b,showWarning:()=>C,verifyModules:()=>w,waitForAllScripts:()=>h,waitForGlobal:()=>u,waitForGlobals:()=>m,waitForNRD:()=>q,waitForServices:()=>Y});const n={DEBUG:0,INFO:1,WARN:2,ERROR:3,AUDIT:4},i={DEBUG:"#6B7280",INFO:"#3B82F6",WARN:"#F59E0B",ERROR:"#EF4444",AUDIT:"#10B981"};class o{constructor(e,t={}){this.appName=e,this.logLevel=void 0!==t.logLevel?t.logLevel:n.INFO,this.enableColors=void 0===t.enableColors||t.enableColors,this.enableTimestamp=void 0===t.enableTimestamp||t.enableTimestamp,this.enableStack=void 0!==t.enableStack&&t.enableStack}getTimestamp(){return this.enableTimestamp?(new Date).toISOString():""}formatMessage(e,t,i=null){const o=this.getTimestamp(),r=Object.keys(n).find(t=>n[t]===e),s=[];return o&&s.push(`[${o}]`),s.push(`[${this.appName}]`),s.push(`[${r}]`),s.push(t),s.join(" ")}formatData(e){if(null==e)return null;if(e instanceof Error)return{name:e.name,message:e.message,stack:this.enableStack?e.stack:void 0};try{return JSON.parse(JSON.stringify(e))}catch(t){return String(e)}}log(e,t,o=null){if(e<this.logLevel)return;const r=this.formatMessage(e,t,o),s=this.formatData(o),a=Object.keys(n).find(t=>n[t]===e),d=this.enableColors?i[a]:null,c=e===n.ERROR?console.error:e===n.WARN?console.warn:console.log;d&&this.enableColors?c(`%c${r}`,`color: ${d}; font-weight: bold`,s||""):c(r,s||"")}debug(e,t=null){this.log(n.DEBUG,e,t)}info(e,t=null){this.log(n.INFO,e,t)}warn(e,t=null){this.log(n.WARN,e,t)}error(e,t=null){this.log(n.ERROR,e,t)}audit(e,t=null){const i={action:e,timestamp:(new Date).toISOString(),user:this.getCurrentUser(),details:t};this.log(n.AUDIT,`AUDIT: ${e}`,i)}getCurrentUser(){try{if("undefined"!=typeof window&&window.nrd&&window.nrd.auth){const e=window.nrd.auth.getCurrentUser();return e?{uid:e.uid,email:e.email}:null}return null}catch(e){return null}}group(e){console.group(`[${this.appName}] ${e}`)}groupEnd(){console.groupEnd()}time(e){console.time(`[${this.appName}] ${e}`)}timeEnd(e){console.timeEnd(`[${this.appName}] ${e}`)}}function r(e,t={}){return new o(e,{logLevel:void 0!==t.logLevel?t.logLevel:n.INFO,enableColors:void 0===t.enableColors||t.enableColors,enableTimestamp:void 0===t.enableTimestamp||t.enableTimestamp,enableStack:void 0!==t.enableStack&&t.enableStack})}const s=15e3,a=100,d=["NRDDataAccess","logger"],c=["showAlert","showSpinner","hideSpinner","showConfirm","window.nrd"],l="INFO";function u(e,t=s){return new Promise(n=>{if(void 0!==window[e])return void n(!0);const i=Date.now(),o=setInterval(()=>{void 0!==window[e]?(clearInterval(o),n(!0)):Date.now()-i>=t&&(clearInterval(o),n(!1))},a)})}function h(e=s){return new Promise(t=>{if("complete"===document.readyState)return void setTimeout(()=>t(!0),100);const n=Date.now();window.addEventListener("load",()=>{setTimeout(()=>t(!0),100)}),setTimeout(()=>{Date.now()-n>=e&&t(!1)},e)})}function m(e,t=s){const n=Array.isArray(e)?e:[e];return new Promise(e=>{const i=Date.now(),o=()=>{n.every(e=>{const t=e.split(".");let n=window;for(const e of t){if(!n||void 0===n[e])return!1;n=n[e]}return!0})?e(!0):Date.now()-i>=t?e(!1):setTimeout(o,a)};o()})}async function w(){const e=[];for(const t of c)await m(t,5e3)||e.push(t);return{success:0===e.length,missing:e}}function g(e,t,n=""){const i=`\n    <div class="min-h-screen flex items-center justify-center bg-white">\n      <div class="text-center max-w-md px-4">\n        <h1 class="text-xl font-light mb-4 text-gray-800">${e}</h1>\n        <p class="text-gray-600 mb-2">${t}</p>\n        ${n?`<p class="text-sm text-gray-500 mt-2">${n}</p>`:""}\n      </div>\n    </div>\n  `;document.body.innerHTML=i}async function f(){try{if(!await u("NRDDataAccess",1e4))return console.error("NRD Data Access Library not loaded after timeout"),g("Error de Carga","No se pudo cargar la librería NRD Data Access","Por favor, verifica tu conexión y recarga la página."),!1;if(window.nrd=new NRDDataAccess,console.log("NRD Data Access initialized successfully"),window.nrd){const e=Object.keys(window.nrd).filter(e=>"object"==typeof window.nrd[e]&&null!==window.nrd[e]&&"function"==typeof window.nrd[e].getAll);console.log("Available NRD services:",e),console.log("measurementUnits available:",!!window.nrd.measurementUnits)}return!0}catch(e){return console.error("Error initializing NRD Data Access:",e),g("Error de Inicialización",`Error al inicializar la aplicación: ${e.message||"Error desconocido"}`,"Por favor, recarga la página."),!1}}async function p(){try{console.log("Waiting for all scripts to load..."),await h(s)||console.warn("Scripts may not have loaded completely, continuing anyway..."),console.log("Verifying required modules...");const e=await w();if(!e.success)return console.error("Missing required modules:",e.missing),void g("Error de Carga","No se pudieron cargar todos los módulos necesarios",`Módulos faltantes: ${e.missing.join(", ")}. Por favor, recarga la página.`);console.log("All modules loaded successfully. Application ready.")}catch(e){console.error("Error during application initialization:",e),g("Error de Inicialización",`Error al inicializar la aplicación: ${e.message||"Error desconocido"}`,"Por favor, recarga la página.")}}function v(e,t,n="Confirmar",i="Cancelar"){return new Promise(o=>{const r=document.getElementById("custom-modal"),s=document.getElementById("modal-title"),a=document.getElementById("modal-message"),d=document.getElementById("modal-confirm"),c=document.getElementById("modal-cancel");s.textContent=e,a.textContent=t,d.textContent=n,c.textContent=i,r.classList.remove("hidden");const l=()=>{r.classList.add("hidden"),d.removeEventListener("click",l),c.removeEventListener("click",u),o(!0)},u=()=>{r.classList.add("hidden"),d.removeEventListener("click",l),c.removeEventListener("click",u),o(!1)};d.addEventListener("click",l),c.addEventListener("click",u);const h=e=>{e.target===r&&(u(),r.removeEventListener("click",h))};r.addEventListener("click",h)})}function y(e,t){return new Promise(n=>{const i=document.getElementById("custom-alert"),o=document.getElementById("alert-title"),r=document.getElementById("alert-message"),s=document.getElementById("alert-ok");o.textContent=e,r.textContent=t,i.classList.remove("hidden");const a=()=>{i.classList.add("hidden"),s.removeEventListener("click",a),n()};s.addEventListener("click",a);const d=e=>{e.target===i&&(a(),i.removeEventListener("click",d))};i.addEventListener("click",d)})}function b(e){return y("Éxito",e)}function E(e){return y("Error",e)}function S(e){return E(e)}function L(e){return y("Información",e)}function C(e){return y("Advertencia",e)}function D(e="Cargando..."){const t=document.getElementById("loading-spinner"),n=t.querySelector("p");n&&(n.textContent=e),t.classList.remove("hidden")}function N(){document.getElementById("loading-spinner").classList.add("hidden")}function I(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function A(e,t=document){try{return t.querySelector(e)}catch(e){return null}}function x(e,t={},n=[]){const i=document.createElement(e);return Object.entries(t).forEach(([e,t])=>{"className"===e?i.className=t:"textContent"===e?i.textContent=t:"innerHTML"===e?i.innerHTML=t:i.setAttribute(e,t)}),n.forEach(e=>{"string"==typeof e?i.appendChild(document.createTextNode(e)):e instanceof Node&&i.appendChild(e)}),i}function k({appName:e,iconPath:t="assets/icons/icon-192.png"}){return`\n    <header class="bg-red-600 border-b border-red-700 px-3 sm:px-4 py-2.5 sm:py-3 flex justify-between items-center sticky top-0 z-10">\n      <div class="flex items-center gap-2 sm:gap-3">\n        <img src="${I(t)}" alt="${I(e)}" class="w-8 h-8 sm:w-10 sm:h-10 rounded">\n        <h1 class="text-lg sm:text-xl font-light tracking-tight text-white">${I(e)}</h1>\n      </div>\n      \n      <div class="flex gap-2 items-center">\n        <button id="install-btn" \n          class="px-3 sm:px-4 py-1.5 sm:py-2 border border-white/30 hover:border-white text-white hover:bg-white/10 transition-colors uppercase tracking-wider text-xs font-light hidden">\n          Instalar\n        </button>\n        \n        <button id="profile-btn" \n          class="px-3 sm:px-4 py-1.5 sm:py-2 border border-white/30 hover:border-white text-white hover:bg-white/10 transition-colors uppercase tracking-wider text-xs font-light">\n          Perfil\n        </button>\n      </div>\n    </header>\n  `}function R(){let e=null;const t=document.getElementById("install-btn");t?(window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),e=n,t&&t.classList.remove("hidden")}),t.addEventListener("click",async()=>{if(!e){const e=window.showInfo||(e=>alert(e));return void await e("Para instalar la app, usa el menú del navegador.")}e.prompt();const{outcome:n}=await e.userChoice;e=null,t&&t.classList.add("hidden")}),window.addEventListener("appinstalled",()=>{e=null,t&&t.classList.add("hidden")})):console.warn("Install button not found")}function B(){const e=document.getElementById("app-header-container");if(!e)return void console.warn("Header container not found");const t=e.dataset.appName||document.querySelector("title")?.textContent?.replace("NRD ","")||"NRD App",n=e.dataset.iconPath||"assets/icons/icon-192.png";e.innerHTML=k({appName:t,iconPath:n}),R();const i=document.getElementById("portal-link");if(i){const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||"0.0.0.0"===window.location.hostname;i.href=e?"/nrd-portal/":"https://yosbany.github.io/nrd-portal"}}function T(e,t=0){if(null==e||isNaN(e))return"0,00";const n=Math.round(parseFloat(e));return isNaN(n)?"0,00":`${n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},00`}function O(e,t=0){return`$${T(e,t)}`}function U(e){if(!e||""===e)return null;const t=String(e).replace(",","."),n=parseFloat(t);return isNaN(n)?null:n}function M(e){return null==e||isNaN(e)?"":String(e).replace(".",",")}function $(e){return["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][e-1]||""}function P(e,t="DD/MM/YYYY"){if(!e)return"";const n=e instanceof Date?e:new Date(e);if(isNaN(n.getTime()))return"";const i=String(n.getDate()).padStart(2,"0"),o=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear();return t.replace("DD",i).replace("MM",o).replace("YYYY",r)}function V(e,t,n){if(!e)return!1;const i=e instanceof Date?e:new Date(e),o=t instanceof Date?t:new Date(t),r=n instanceof Date?n:new Date(n);return i>=o&&i<=r}function F(e){return e&&"string"==typeof e?e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/ñ/g,"n").replace(/v/g,"b").replace(/c([ei])/g,"s$1").replace(/z/g,"s").replace(/ll/g,"y").trim().replace(/\s+/g," "):""}function z(e,t){if(!t||!t.trim())return!0;if(!e)return!1;const n=F(e),i=F(t);return n.includes(i)}function H(e,t,n){if(!t||!t.trim())return e;if(!Array.isArray(e))return[];const i=F(t);return e.filter(e=>"function"==typeof n?z(n(e),i):Array.isArray(n)?n.some(t=>{const n=(o=e,t.split(".").reduce((e,t)=>e?.[t],o));var o;return z(String(n||""),i)}):Object.values(e).some(e=>"string"==typeof e&&z(e,i)))}function j(){let e="undefined"!=typeof window&&window.logger||console;return e.debug||(e.debug=e.log||console.log),e.info||(e.info=e.log||console.log),e.warn||(e.warn=console.warn||console.log),e.error||(e.error=console.error||console.log),e.audit||(e.audit=e.info||e.log||console.log),e}"undefined"!=typeof window&&(window.showConfirm=v,window.showAlert=y,window.showSuccess=b,window.showError=S,window.showErrorAlert=E,window.showInfo=L),"undefined"!=typeof window&&(window.showSpinner=D,window.hideSpinner=N),"undefined"!=typeof window&&(window.escapeHtml=I),"undefined"!=typeof window&&(window.formatNumber=T,window.formatCurrency=O,window.parseDecimalWithComma=U,window.formatDecimalWithComma=M),"undefined"!=typeof window&&(window.getMonthName=$),"undefined"!=typeof window&&(window.normalizeSearchText=F,window.matchesSearch=z,window.filterBySearch=H);class G{constructor(e){this.nrd=e,this.currentUser=null,this.authCheckComplete=!1,this.unsubscribe=null,this.init()}init(){if(this.nrd&&this.nrd.auth){const e=this.nrd.auth.getCurrentUser();e&&(j().info("Current user found immediately",{uid:e.uid,email:e.email}),this.authCheckComplete=!0,this.currentUser=e,this.hideRedirectingScreen(),this.showAppScreen()),this.unsubscribe=this.nrd.auth.onAuthStateChanged(e=>{try{if(this.authCheckComplete&&this.currentUser&&e&&this.currentUser.uid===e.uid)return void j().debug("Auth state change for same user, skipping");this.authCheckComplete=!0,this.currentUser=e,this.hideRedirectingScreen(),e?(j().info("User authenticated, showing app screen",{uid:e.uid,email:e.email}),this.showAppScreen()):(j().info("User not authenticated, showing login screen"),this.showLoginScreen())}catch(e){j().error("Error in auth state change",e),this.hideRedirectingScreen();const t=document.getElementById("login-screen"),n=document.getElementById("app-screen");t&&t.classList.remove("hidden"),n&&n.classList.add("hidden")}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initAuthCheck()):this.initAuthCheck(),this.setupLoginForm(),this.initializeHeader(),setTimeout(()=>{if(!this.authCheckComplete){j().warn("Auth check timeout, forcing check");const e=this.nrd.auth.getCurrentUser();e?(this.authCheckComplete=!0,this.currentUser=e,this.hideRedirectingScreen(),this.showAppScreen()):(this.hideRedirectingScreen(),this.showLoginScreen())}},3e3)}else j().error("nrd or nrd.auth is not available"),this.showRedirectingScreen(),setTimeout(()=>{this.hideRedirectingScreen(),this.showLoginScreen()},300)}showRedirectingScreen(){const e=document.getElementById("redirecting-screen"),t=document.getElementById("login-screen"),n=document.getElementById("app-screen");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),n&&n.classList.add("hidden")}hideRedirectingScreen(){const e=document.getElementById("redirecting-screen");e&&e.classList.add("hidden")}hasStoredToken(){try{return Object.keys(localStorage).filter(e=>e.startsWith("firebase:authUser:")).length>0}catch(e){return j().error("Error checking stored token",e),!1}}initAuthCheck(){if(this.authCheckComplete&&this.currentUser)return void j().debug("User already authenticated, skipping redirecting screen");this.showRedirectingScreen();const e=this.nrd.auth.getCurrentUser();if(e)return j().info("Current user found in initAuthCheck",{uid:e.uid}),this.authCheckComplete=!0,this.currentUser=e,this.hideRedirectingScreen(),void this.showAppScreen();this.hasStoredToken()?(j().debug("Stored token found, waiting for auth state change"),setTimeout(()=>{if(!this.authCheckComplete){const e=this.nrd.auth.getCurrentUser();e?(this.authCheckComplete=!0,this.currentUser=e,this.hideRedirectingScreen(),this.showAppScreen()):(j().info("Token found but authentication not restored, showing login"),this.hideRedirectingScreen(),this.showLoginScreen())}},1500)):(j().debug("No stored token found, showing login immediately"),setTimeout(()=>{this.hideRedirectingScreen(),this.showLoginScreen()},300))}showLoginScreen(){j().debug("Showing login screen");try{const e=document.getElementById("login-screen"),t=document.getElementById("app-screen");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden")}catch(e){j().error("Error showing login screen",e)}}showAppScreen(){j().debug("Showing app screen");try{const e=document.getElementById("login-screen"),t=document.getElementById("app-screen"),n=document.getElementById("redirecting-screen");e&&e.classList.add("hidden"),n&&n.classList.add("hidden"),t?(t.classList.remove("hidden"),j().debug("App screen shown successfully")):j().error("App screen element not found"),setTimeout(()=>{j().debug("Attempting to switch to default view: dashboard"),window.navigationService&&"function"==typeof window.navigationService.switchView?(j().debug("Switching to default view: dashboard (via navigationService)"),window.navigationService.switchView("dashboard")):"function"==typeof window.switchView?(j().debug("Switching to default view: dashboard (via window.switchView)"),window.switchView("dashboard")):(j().warn("switchView function and navigationService not available yet, will retry"),setTimeout(()=>{window.navigationService&&"function"==typeof window.navigationService.switchView?(j().debug("Retrying switch to dashboard view"),window.navigationService.switchView("dashboard")):"function"==typeof window.switchView&&(j().debug("Retrying switch to dashboard view (via window.switchView)"),window.switchView("dashboard"))},1e3))},500)}catch(e){j().error("Error showing app screen",e)}}setupLoginForm(){const e=document.getElementById("login-form");e&&e.addEventListener("submit",async e=>{e.preventDefault();try{const e=document.getElementById("login-email")?.value,t=document.getElementById("login-password")?.value,n=document.getElementById("login-error");if(!e||!t)return j().warn("Login attempt with empty fields"),void(n&&(n.textContent="Por favor complete todos los campos"));if(j().info("Attempting user login",{email:e}),n&&(n.textContent=""),!this.nrd||!this.nrd.auth)return j().error("nrd or nrd.auth is not available"),void(n&&(n.textContent="Error: Servicio no disponible"));D("Iniciando sesión...");const i=(await this.nrd.auth.signIn(e,t)).user;j().audit("USER_LOGIN",{email:e,uid:i.uid,timestamp:Date.now()}),j().info("User login successful",{uid:i.uid,email:e}),N()}catch(e){N(),j().error("Login failed",e);const t=document.getElementById("login-error");t&&(t.textContent=e.message||"Error al iniciar sesión")}})}setupProfileHandlers(){const e=document.getElementById("profile-btn");if(e){const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>{this.showProfileModal()})}const t=document.getElementById("close-profile-modal");t&&t.addEventListener("click",()=>{this.closeProfileModal()});const n=document.getElementById("profile-logout-btn");n&&n.addEventListener("click",async()=>{try{const e=this.getCurrentUser();if(j().info("Attempting user logout",{uid:e?.uid,email:e?.email}),this.closeProfileModal(),!this.nrd||!this.nrd.auth)return void j().error("nrd or nrd.auth is not available");D("Cerrando sesión..."),await this.nrd.auth.signOut(),j().audit("USER_LOGOUT",{uid:e?.uid,email:e?.email,timestamp:Date.now()}),j().info("User logout successful"),N()}catch(e){N(),j().error("Logout failed",e)}})}showProfileModal(){j().debug("Showing profile modal");const e=document.getElementById("profile-modal"),t=document.getElementById("profile-modal-content");if(!e||!t)return void j().warn("Profile modal elements not found");const n=this.getCurrentUser();if(!n)return void j().warn("No user found when showing profile modal");j().debug("Displaying user profile data",{uid:n.uid,email:n.email});let i=`\n      <div class="space-y-3 sm:space-y-4">\n        <div class="flex justify-between py-2 sm:py-3 border-b border-gray-200">\n          <span class="text-gray-600 font-light text-sm sm:text-base">Email:</span>\n          <span class="font-light text-sm sm:text-base">${I(n.email||"N/A")}</span>\n        </div>\n        ${n.displayName?`\n        <div class="flex justify-between py-2 sm:py-3 border-b border-gray-200">\n          <span class="text-gray-600 font-light text-sm sm:text-base">Nombre:</span>\n          <span class="font-light text-sm sm:text-base">${I(n.displayName)}</span>\n        </div>\n        `:""}\n      </div>\n    `;t.innerHTML=i,e.classList.remove("hidden"),j().debug("Profile modal shown")}closeProfileModal(){j().debug("Closing profile modal");const e=document.getElementById("profile-modal");e&&(e.classList.add("hidden"),j().debug("Profile modal closed"))}initializeHeader(){const e=()=>{B(),setTimeout(()=>{this.setupProfileHandlers()},100)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}getCurrentUser(){return this.nrd&&this.nrd.auth&&this.nrd.auth.getCurrentUser()||this.currentUser}destroy(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}}function W(){let e="undefined"!=typeof window&&window.logger||console;return e.debug||(e.debug=e.log||console.log),e.info||(e.info=e.log||console.log),e.warn||(e.warn=console.warn||console.log),e.error||(e.error=console.error||console.log),e.audit||(e.audit=e.info||e.log||console.log),e}class _{constructor(e=null){this.currentView=null,e&&Array.isArray(e)?this.views=e:this.views=this.detectViewsFromDOM(),this.viewHandlers=new Map}detectViewsFromDOM(){const e=document.querySelectorAll('[id$="-view"]'),t=Array.from(e).map(e=>e.id.replace("-view",""));return W().debug("Auto-detected views from DOM",{views:t}),t.length>0?t:["dashboard","payroll-items"]}registerView(e,t){this.viewHandlers.set(e,t)}switchView(e){if(this.currentView===e)return void W().debug("View already active, skipping",{viewName:e});W().info("Switching view",{from:this.currentView,to:e}),this.currentView=e;const t=document.getElementById("app-screen");t&&t.classList.contains("hidden")&&(W().warn("App screen was hidden, showing it now"),t.classList.remove("hidden")),this.views.forEach(e=>{const t=document.getElementById(`${e}-view`);t?(t.classList.add("hidden"),W().debug("Hiding view",{view:e})):W().warn("View element not found for hiding",{view:e})});const n=document.getElementById(`${e}-view`);n?(n.classList.remove("hidden"),W().info("View shown successfully",{viewName:e,elementId:`${e}-view`})):W().error("View element not found",{viewName:e,elementId:`${e}-view`,availableViews:this.views}),document.querySelectorAll(".nav-btn").forEach(e=>{e.classList.remove("border-red-600","text-red-600","bg-red-50","font-medium"),e.classList.add("border-transparent","text-gray-600")});const i=document.querySelector(`[data-view="${e}"]`);i?(i.classList.remove("border-transparent","text-gray-600"),i.classList.add("border-red-600","text-red-600","bg-red-50","font-medium")):W().warn("Active nav button not found",{viewName:e}),W().debug("Loading view data",{viewName:e});const o=this.viewHandlers.get(e);o?o():"dashboard"===e?"function"==typeof window.initializeDashboard?window.initializeDashboard():"function"==typeof window.loadDashboard&&window.loadDashboard():"payroll-items"===e&&("function"==typeof window.initializePayrollItems?window.initializePayrollItems():"function"==typeof window.loadPayrollItems&&window.loadPayrollItems()),W().debug("View switched successfully",{viewName:e})}setupNavButtons(){W().debug("Setting up nav button handlers"),document.querySelectorAll(".nav-btn").forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",()=>{const e=t.dataset.view;W().debug("Nav button clicked",{view:e}),this.switchView(e)})}),W().debug("Nav button handlers attached")}getCurrentView(){return this.currentView}}function q(e=5e3){return new Promise((t,n)=>{const i=Date.now(),o=()=>{const r=window.nrd;r?t(r):Date.now()-i>=e?n(new Error("NRD instance not found")):setTimeout(o,100)};o()})}function Y(e,t=null,n=5e3){return new Promise((i,o)=>{const r=Date.now(),s=()=>{const a=t||window.nrd;if(!a)return Date.now()-r>=n?void o(new Error("NRD instance not found")):void setTimeout(s,100);e.every(e=>void 0!==a[e])?i(a):Date.now()-r>=n?o(new Error(`Services not available after timeout: ${e.join(", ")}`)):setTimeout(s,100)};s()})}"undefined"!=typeof window&&(window.switchView=function(e){window.navigationService&&window.navigationService.switchView(e)});const J={Logger:o,LOG_LEVELS:n,createLogger:r,waitForGlobal:u,waitForAllScripts:h,waitForGlobals:m,verifyModules:w,initializeNRD:f,initializeApplication:p,showConfirm:v,showAlert:y,showError:S,showErrorAlert:E,showSuccess:b,showInfo:L,showWarning:C,showSpinner:D,hideSpinner:N,createAppHeader:k,setupInstallButton:R,initializeAppHeader:B,formatNumber:T,formatCurrency:O,formatDecimalWithComma:M,parseDecimalWithComma:U,escapeHtml:I,querySelectorSafe:A,createElement:x,getMonthName:$,formatDate:P,normalizeSearchText:F,matchesSearch:z,filterBySearch:H,AuthService:G,NavigationService:_,waitForNRD:q,waitForServices:Y};return t})());